"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),t}$(document).on("click",".button--basket",function(){$(this).hasClass("animate")||($(this).addClass("animate"),$(this).addClass("button--check"),setTimeout(function(){$(this).removeClass("button--check"),$(this).removeClass("animate")}.bind(this),2e3))}),window.addEventListener("load",function(){$(".hr-sect").length&&$(".hr-pagination__step").click(function(){var t=$(this);if(!t.hasClass("is-active")){t.closest(".hr-sect").find(".hr-pagination__step").removeClass("is-active").removeClass("button"),t.addClass("is-active").addClass("button"),t.attr("data-index");var e=t.closest(".hr-sect").find(".hr-slider-slide");e.removeClass("is-active"),e.each(function(t,e){$(this).attr("data-index")==$(".hr-pagination__step.is-active").attr("data-index")&&$(this).addClass("is-active")})}})}),function(){var t=document.getElementById("menu-button");t.addEventListener("click",function(){t.classList.toggle("opened")}),window.onresize=function(){t.classList.remove("opened")},window.onscroll=function(){t.classList.remove("opened")}}(),function(){var t=function(){function o(t,e,s,i){if(_classCallCheck(this,o),void 0===t)return!1;this._self=t,this._title=this._self.querySelectorAll("."+e)[0],this._products=this._self.querySelectorAll("."+s)[0],this.preloader=this._self.querySelectorAll("."+i)[0]}return _createClass(o,[{key:"_cleanProducts",value:function(){this._products.innerHTML=""}},{key:"playPreloader",value:function(){this.preloader.classList.add("preloader--active")}},{key:"stopPreloader",value:function(){this.preloader.classList.remove("preloader--active")}},{key:"updateTitle",value:function(t){this._title.innerHTML=t,this._title.setAttribute("data-name",t)}},{key:"updateListProducts",value:function(t){this._products.innerHTML=t}},{key:"addProducts",value:function(t){this._products.insertAdjacentHTML("beforeend",t)}}]),o}(),e=function(){function i(t,e,s){return _classCallCheck(this,i),void 0!==t&&(void 0!==e&&(void 0!==s&&(this._containerBrands=t,this._brandItem=this._containerBrands.querySelectorAll(".catalog-nav__controls-link"),this._containerFilter=e,this._filterItem=this._containerFilter.querySelectorAll(".catalog-filter__col-btn"),this.searchItem=this._containerFilter.querySelectorAll(".catalog-filter__form")[0],this._activeClass="is-active",this._sortTypeAsc={class:"sort-down",dataSort:"asc"},this._sortTypeDesc={class:"sort-up",dataSort:"desc"},this._containerMore=s,this.timeOutAjax,void this.init())))}return _createClass(i,[{key:"_cleanClassFilterAll",value:function(){var s=this;this._filterItem.forEach(function(t){var e=t.closest(".catalog-filter__col");t.classList.remove(s._activeClass),t.classList.remove(s._sortTypeAsc.class),e.removeAttribute("data-sort")})}},{key:"_addClassFilter",value:function(t){var e=t.closest(".catalog-filter__col");t.classList.add(this._activeClass),t.classList.add(this._sortTypeAsc.class),e.setAttribute("data-sort",this._sortTypeAsc.dataSort)}},{key:"_toogleSort",value:function(t){var e=t.closest(".catalog-filter__col");t.classList.contains(this._sortTypeAsc.class)?(t.classList.remove(this._sortTypeAsc.class),t.classList.add(this._sortTypeDesc.class),e.setAttribute("data-sort",this._sortTypeDesc.dataSort)):(t.classList.remove(this._sortTypeDesc.class),t.classList.add(this._sortTypeAsc.class),e.setAttribute("data-sort",this._sortTypeAsc.dataSort))}},{key:"_selectBrand",value:function(t){t.classList.contains("is-active")||(this._brandItem.forEach(function(t){t.classList.remove("is-active")}),t.classList.add("is-active"))}},{key:"_queryFormation",value:function(t,e){clearTimeout(this.timeOutAjax);var s,i,o=[],a=this.searchItem.getElementsByTagName("input")[0];this._brandItem.forEach(function(t){t.classList.contains("is-active")&&(o.push("brand="+t.getAttribute("data-brand")),s=t.getAttribute("data-brand"))}),this._filterItem.forEach(function(t){var e=t.closest(".catalog-filter__col");t.classList.contains("is-active")&&(o.push("sort="+e.getAttribute("data-sort")),o.push("sortType="+e.getAttribute("data-filter")))}),""!==a.value&&o.push("search="+a.value),i="?"+o.join("&"),new r(i).setHistory(s);var n=new l("test.json","get",t);void 0===e?n.send():(c.playPreloader(),this.timeOutAjax=setTimeout(function(){n.send()},e)),console.log(i)}},{key:"init",value:function(){var e=this;this._filterItem.forEach(function(t){t.addEventListener("click",function(){t.classList.contains(e._activeClass)?e._toogleSort(this):(e._cleanClassFilterAll(),e._addClassFilter(this)),e._queryFormation(!0)})}),this._brandItem.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),this.classList.contains("is-active")||(e._selectBrand(this),e._queryFormation(!0))})}),this.searchItem.getElementsByTagName("input")[0].addEventListener("input",function(){e._queryFormation(!0,1e3)}),this._containerMore.querySelectorAll(".catalog__more-button")[0].addEventListener("click",function(t){t.preventDefault(),e._queryFormation(!1)})}}]),i}(),r=function(){function e(t){_classCallCheck(this,e),this._url=t,this._historyObj=window.history}return _createClass(e,[{key:"setHistory",value:function(t){t===this._historyObj.state?this._historyObj.replaceState(t,t,this._url):this._historyObj.pushState(t,t,this._url)}},{key:"readHistory",value:function(t){}}]),e}(),l=function(){function i(t,e,s){_classCallCheck(this,i),this._url=t,this._type=e,this._productUpdate=s,this.ajax=new XMLHttpRequest}return _createClass(i,[{key:"_progress",value:function(){c.playPreloader()}},{key:"_complete",value:function(){var t=JSON.parse(this.response);!0===productUpdate?(c.updateTitle(t.title),c.updateListProducts(t.elements)):c.addProducts(t.elements),c.stopPreloader(),console.log(t)}},{key:"_completeUpdatePrpoducts",value:function(){var t=JSON.parse(this.response);c.updateTitle(t.title),c.updateListProducts(t.elements),c.stopPreloader(),console.log(t)}},{key:"_completeAddProducts",value:function(){var t=JSON.parse(this.response);c.addProducts(t.elements),c.stopPreloader(),console.log(t)}},{key:"send",value:function(t){var e=this._productUpdate,s=this;this.ajax.addEventListener("progress",this._progress,!1),this.ajax.addEventListener("load",!0===e?s._completeUpdatePrpoducts:s._completeAddProducts,!1),"get"===this._type.toLowerCase()?(this.ajax.open(this._type,this._url),this.ajax.send(),console.log("get")):"post"===this._type.toLowerCase()?console.log("post"):console.log("Error")}}]),i}(),c=new t(document.querySelectorAll(".catalog")[0],"catalog__title","catalog__product","preloader"),s=new e(document.querySelectorAll(".catalog-nav__controls")[0],document.querySelectorAll(".catalog-filter")[0],document.querySelectorAll(".catalog__more")[0]);window.filter=s}(),$(".footer__col-title").on("click",function(t){t.preventDefault(),$(this).closest(".footer__col").find(".footer__col-list").slideToggle(300)}),window.addEventListener("load",function(){if($(".catalog-nav__controls").length){var t=function(){i=s.position().left,a=s.position().top,s.innerWidth(),s.innerHeight(),o.css({left:i,top:a,width:0,height:0})},e=$(".catalog-nav__controls-link"),s=($(".catalog-nav__controls-list"),$(".catalog-nav__controls-item"),$(".catalog-nav__controls-link.is-active")),o=$(".catalog-nav__hover"),i=s.position().left,a=s.position().top,n=(s.innerWidth(),s.innerHeight(),!1);e.hover(function(){var t=$(this).position().left,e=$(this).position().top,s=$(this).innerWidth(),i=$(this).innerHeight();o.css({left:t,top:e,width:s,height:i}),n=!1},function(){setTimeout(function(){n&&o.css({left:i,top:a,width:0,height:0})},1e3),n=!0}),$(window).resize(function(){t()}),t()}}),window.addEventListener("load",function(){$(".delivery__form-input").focusout(function(){""!==$(this).val()?$(this).parent().addClass("value"):$(this).parent().removeClass("value")})}),function(){var t=document.getElementById("scene");if(null!=t)new Parallax(t)}(),$(document).on("click",".slide-info__button",function(){$(this).closest(".slide-info").find(".slide-info__button").toggleClass("is-active"),$(this).closest(".slide-info").find(".slide-info__content").slideToggle(300)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZFRvQmFza2V0LmpzIiwiYmFza2V0VGFicy5qcyIsImJ1cmdlci5qcyIsImNhdGFsb2dVcGRhdGVDbGFzcy5qcyIsImZvb3Rlck1lbnUuanMiLCJob3ZlclJvbGxlci5qcyIsImxhYmVsRm9ybS5qcyIsInBhcmFsbGF4LmpzIiwic2hvd01vcmUuanMiXSwibmFtZXMiOlsiJCIsImRvY3VtZW50Iiwib24iLCJ0aGlzIiwiaGFzQ2xhc3MiLCJhZGRDbGFzcyIsInNldFRpbWVvdXQiLCJyZW1vdmVDbGFzcyIsImJpbmQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwibGVuZ3RoIiwiY2xpY2siLCJ0aFN0ZXAiLCJjbG9zZXN0IiwiZmluZCIsImF0dHIiLCJzbGlkZXJTbGlkZXMiLCJlYWNoIiwicGFnaUluZGV4IiwibWVudUJ0biIsImdldEVsZW1lbnRCeUlkIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwib25yZXNpemUiLCJyZW1vdmUiLCJvbnNjcm9sbCIsIkNhdGFsb2ciLCJzZWxmIiwidGl0bGVDbGFzcyIsInByb2R1Y3RzQ29udGFpbmVyQ2xhc3MiLCJwcm9kdWN0c1ByZWxvYWRlckNsYXNzIiwiX2NsYXNzQ2FsbENoZWNrIiwidW5kZWZpbmVkIiwiX3NlbGYiLCJfdGl0bGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX3Byb2R1Y3RzIiwicHJlbG9hZGVyIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJpbm5lckhUTUwiLCJhZGQiLCJ0aXRsZSIsInNldEF0dHJpYnV0ZSIsInByb2R1Y3RzIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwiRmlsdGVyIiwiY29udGFpbmVyQnJhbmRzIiwiY29udGFpbmVyRmlsdGVyIiwiY29udGFpbmVyTW9yZSIsIl9jb250YWluZXJCcmFuZHMiLCJfYnJhbmRJdGVtIiwiX2NvbnRhaW5lckZpbHRlciIsIl9maWx0ZXJJdGVtIiwic2VhcmNoSXRlbSIsIl9hY3RpdmVDbGFzcyIsIl9zb3J0VHlwZUFzYyIsImNsYXNzIiwiZGF0YVNvcnQiLCJfc29ydFR5cGVEZXNjIiwiX2NvbnRhaW5lck1vcmUiLCJ0aW1lT3V0QWpheCIsImluaXQiLCJmb3JFYWNoIiwiaXRlbSIsInBhcmVudCIsInJlbW92ZUF0dHJpYnV0ZSIsImNvbnRhaW5zIiwicHJvZHVjdFVwZGF0ZSIsImRlbGF5IiwiY2xlYXJUaW1lb3V0IiwiYnJhbmQiLCJnZXRRdWVyeSIsImFycmF5UXVlcnkiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInB1c2giLCJnZXRBdHRyaWJ1dGUiLCJqb2luIiwiSGlzdG9yeUNvbnJ0b2wiLCJzZXRIaXN0b3J5IiwiYWpheENvbm5lY3QiLCJBamF4R2V0UHJvZHVjdHMiLCJzZW5kIiwiY2F0YWxvZFRlc3QiLCJwbGF5UHJlbG9hZGVyIiwiY29uc29sZSIsImxvZyIsIl90b29nbGVTb3J0IiwiX2NsZWFuQ2xhc3NGaWx0ZXJBbGwiLCJfYWRkQ2xhc3NGaWx0ZXIiLCJfcXVlcnlGb3JtYXRpb24iLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiX3NlbGVjdEJyYW5kIiwidXJsIiwiX3VybCIsIl9oaXN0b3J5T2JqIiwiaGlzdG9yeSIsInN0YXRlIiwicmVwbGFjZVN0YXRlIiwicHVzaFN0YXRlIiwidHlwZSIsIl90eXBlIiwiX3Byb2R1Y3RVcGRhdGUiLCJhamF4IiwiWE1MSHR0cFJlcXVlc3QiLCJyZXN1bHQiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZSIsInVwZGF0ZVRpdGxlIiwidXBkYXRlTGlzdFByb2R1Y3RzIiwiZWxlbWVudHMiLCJhZGRQcm9kdWN0cyIsInN0b3BQcmVsb2FkZXIiLCJkYXRhIiwiX3Byb2dyZXNzIiwiX2NvbXBsZXRlVXBkYXRlUHJwb2R1Y3RzIiwiX2NvbXBsZXRlQWRkUHJvZHVjdHMiLCJ0b0xvd2VyQ2FzZSIsIm9wZW4iLCJmaWx0ZXIiLCJlIiwic2xpZGVUb2dnbGUiLCJyZXNpemVQb3MiLCJhY3RpdmVMaW5rUG9zTGVmdCIsImFjdGl2ZUxpbmsiLCJwb3NpdGlvbiIsImxlZnQiLCJhY3RpdmVMaW5rUG9zVG9wIiwidG9wIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiaG92ZXJCb3giLCJjc3MiLCJ3aWR0aCIsImhlaWdodCIsIm1lbnVMaW5rIiwiY2hlY2siLCJob3ZlciIsIm5ld0xpbmtQb3NMZWZ0IiwibmV3TGlua1Bvc1RvcCIsIm5ld0xpbmtXaWR0aCIsIm5ld0xpbmtIZWlnaHQiLCJyZXNpemUiLCJmb2N1c291dCIsInZhbCIsInNjZW5lIiwiUGFyYWxsYXgiLCJ0b2dnbGVDbGFzcyJdLCJtYXBwaW5ncyI6Im1aQUNJQSxFQUFFQyxVQUFVQyxHQUFHLFFBQVMsa0JBQW1CLFdBQ2xDRixFQUFFRyxNQUFNQyxTQUFTLGFBQ2xCSixFQUFFRyxNQUFNRSxTQUFTLFdBQ2pCTCxFQUFFRyxNQUFNRSxTQUFTLGlCQUNqQkMsV0FBVyxXQUNQTixFQUFFRyxNQUFNSSxZQUFZLGlCQUNwQlAsRUFBRUcsTUFBTUksWUFBWSxZQUN0QkMsS0FBS0wsTUFBTyxRQ050Qk0sT0FBT0MsaUJBQWlCLE9BQVEsV0FFeEJWLEVBQUUsWUFBWVcsUUFFZFgsRUFBRSx3QkFBd0JZLE1BQU0sV0FDNUIsSUFBSUMsRUFBU2IsRUFBRUcsTUFDZixJQUFLVSxFQUFPVCxTQUFTLGFBQWMsQ0FDL0JTLEVBQU9DLFFBQVEsWUFBWUMsS0FBSyx3QkFBd0JSLFlBQVksYUFBYUEsWUFBWSxVQUM3Rk0sRUFBT1IsU0FBUyxhQUFhQSxTQUFTLFVBQ3RCUSxFQUFPRyxLQUFLLGNBQTVCLElBRUlDLEVBQWVKLEVBQU9DLFFBQVEsWUFBWUMsS0FBSyxvQkFDbkRFLEVBQWFWLFlBQVksYUFDekJVLEVBQWFDLEtBQUssU0FBU0MsRUFBV04sR0FDOUJiLEVBQUVHLE1BQU1hLEtBQUssZUFBaUJoQixFQUFFLGtDQUFrQ2dCLEtBQUssZUFDdkVoQixFQUFFRyxNQUFNRSxTQUFTLG9CQ2pCNUMsV0FDRyxJQUFJZSxFQUFVbkIsU0FBU29CLGVBQWUsZUFFdENELEVBQVFWLGlCQUFpQixRQUFTLFdBQzlCVSxFQUFRRSxVQUFVQyxPQUFPLFlBRzdCZCxPQUFPZSxTQUFXLFdBQ2RKLEVBQVFFLFVBQVVHLE9BQU8sV0FFN0JoQixPQUFPaUIsU0FBVyxXQUNkTixFQUFRRSxVQUFVRyxPQUFPLFdBWGhDLEdDQUEsV0FBVyxJQUVGRSxFQUZFLFdBR0osU0FBQUEsRUFBWUMsRUFBTUMsRUFBWUMsRUFBd0JDLEdBQ2xELEdBRHlFQyxnQkFBQTdCLEtBQUF3QixRQUM1RE0sSUFBVEwsRUFDQSxPQUFPLEVBRVh6QixLQUFLK0IsTUFBUU4sRUFDYnpCLEtBQUtnQyxPQUFTaEMsS0FBSytCLE1BQU1FLGlCQUFpQixJQUFNUCxHQUFZLEdBQzVEMUIsS0FBS2tDLFVBQVlsQyxLQUFLK0IsTUFBTUUsaUJBQWlCLElBQU1OLEdBQXdCLEdBQzNFM0IsS0FBS21DLFVBQVluQyxLQUFLK0IsTUFBTUUsaUJBQWlCLElBQU1MLEdBQXdCLEdBVjNFLE9BQUFRLGFBQUFaLEVBQUEsQ0FBQSxDQUFBYSxJQUFBLGlCQUFBQyxNQUFBLFdBZUF0QyxLQUFLa0MsVUFBVUssVUFBWSxLQWYzQixDQUFBRixJQUFBLGdCQUFBQyxNQUFBLFdBbUJBdEMsS0FBS21DLFVBQVVoQixVQUFVcUIsSUFBSSx1QkFuQjdCLENBQUFILElBQUEsZ0JBQUFDLE1BQUEsV0F1QkF0QyxLQUFLbUMsVUFBVWhCLFVBQVVHLE9BQU8sdUJBdkJoQyxDQUFBZSxJQUFBLGNBQUFDLE1BQUEsU0EwQlFHLEdBQ1J6QyxLQUFLZ0MsT0FBT08sVUFBWUUsRUFDeEJ6QyxLQUFLZ0MsT0FBT1UsYUFBYSxZQUFhRCxLQTVCdEMsQ0FBQUosSUFBQSxxQkFBQUMsTUFBQSxTQStCZUssR0FDZjNDLEtBQUtrQyxVQUFVSyxVQUFZSSxJQWhDM0IsQ0FBQU4sSUFBQSxjQUFBQyxNQUFBLFNBbUNRSyxHQUNSM0MsS0FBS2tDLFVBQVVVLG1CQUFtQixZQUFhRCxPQXBDL0NuQixFQUFBLEdBd0NGcUIsRUF4Q0UsV0F5Q0osU0FBQUEsRUFBWUMsRUFBaUJDLEVBQWlCQyxHQUMxQyxPQUR5RG5CLGdCQUFBN0IsS0FBQTZDLFFBQ2pDZixJQUFwQmdCLFNBR29CaEIsSUFBcEJpQixTQUdrQmpCLElBQWxCa0IsSUFJSmhELEtBQUtpRCxpQkFBbUJILEVBQ3hCOUMsS0FBS2tELFdBQWFsRCxLQUFLaUQsaUJBQWlCaEIsaUJBQWlCLCtCQUV6RGpDLEtBQUttRCxpQkFBbUJKLEVBQ3hCL0MsS0FBS29ELFlBQWNwRCxLQUFLbUQsaUJBQWlCbEIsaUJBQWlCLDRCQUMxRGpDLEtBQUtxRCxXQUFhckQsS0FBS21ELGlCQUFpQmxCLGlCQUFpQix5QkFBeUIsR0FDbEZqQyxLQUFLc0QsYUFBZSxZQUNwQnRELEtBQUt1RCxhQUFlLENBQ2hCQyxNQUFPLFlBQ1BDLFNBQVUsT0FFZHpELEtBQUswRCxjQUFnQixDQUNqQkYsTUFBTyxVQUNQQyxTQUFVLFFBR2R6RCxLQUFLMkQsZUFBaUJYLEVBRXRCaEQsS0FBSzRELGlCQUNMNUQsS0FBSzZELFVBdkVMLE9BQUF6QixhQUFBUyxFQUFBLENBQUEsQ0FBQVIsSUFBQSx1QkFBQUMsTUFBQSxXQTJFQSxJQUFJYixFQUFPekIsS0FFWEEsS0FBS29ELFlBQVlVLFFBQVEsU0FBU0MsR0FDOUIsSUFBSUMsRUFBU0QsRUFBS3BELFFBQVEsd0JBRXRCb0QsRUFBSzVDLFVBQVVHLE9BQU9HLEVBQUs2QixjQUMzQlMsRUFBSzVDLFVBQVVHLE9BQU9HLEVBQUs4QixhQUFMLE9BQ3RCUyxFQUFPQyxnQkFBZ0IsaUJBbEYvQixDQUFBNUIsSUFBQSxrQkFBQUMsTUFBQSxTQXVGWXlCLEdBQ1osSUFBSUMsRUFBU0QsRUFBS3BELFFBQVEsd0JBRTFCb0QsRUFBSzVDLFVBQVVxQixJQUFJeEMsS0FBS3NELGNBQ3hCUyxFQUFLNUMsVUFBVXFCLElBQUl4QyxLQUFLdUQsYUFBTCxPQUVuQlMsRUFBT3RCLGFBQWEsWUFBYTFDLEtBQUt1RCxhQUFhRSxZQTdGbkQsQ0FBQXBCLElBQUEsY0FBQUMsTUFBQSxTQWdHUXlCLEdBQ1IsSUFBSUMsRUFBU0QsRUFBS3BELFFBQVEsd0JBRXRCb0QsRUFBSzVDLFVBQVUrQyxTQUFTbEUsS0FBS3VELGFBQUwsUUFDeEJRLEVBQUs1QyxVQUFVRyxPQUFPdEIsS0FBS3VELGFBQUwsT0FDdEJRLEVBQUs1QyxVQUFVcUIsSUFBSXhDLEtBQUswRCxjQUFMLE9BRW5CTSxFQUFPdEIsYUFBYSxZQUFhMUMsS0FBSzBELGNBQWNELFlBRXBETSxFQUFLNUMsVUFBVUcsT0FBT3RCLEtBQUswRCxjQUFMLE9BQ3RCSyxFQUFLNUMsVUFBVXFCLElBQUl4QyxLQUFLdUQsYUFBTCxPQUVuQlMsRUFBT3RCLGFBQWEsWUFBYTFDLEtBQUt1RCxhQUFhRSxhQTVHdkQsQ0FBQXBCLElBQUEsZUFBQUMsTUFBQSxTQWlIU3lCLEdBQ0pBLEVBQUs1QyxVQUFVK0MsU0FBUyxlQUN6QmxFLEtBQUtrRCxXQUFXWSxRQUFRLFNBQVNDLEdBQzdCQSxFQUFLNUMsVUFBVUcsT0FBTyxlQUUxQnlDLEVBQUs1QyxVQUFVcUIsSUFBSSxnQkF0SHZCLENBQUFILElBQUEsa0JBQUFDLE1BQUEsU0EwSFk2QixFQUFlQyxHQUMzQkMsYUFBYXJFLEtBQUs0RCxhQUVsQixJQUVJVSxFQUNBQyxFQUhBQyxFQUFhLEdBQ2JuQixFQUFhckQsS0FBS3FELFdBQVdvQixxQkFBcUIsU0FBUyxHQUkvRHpFLEtBQUtrRCxXQUFXWSxRQUFRLFNBQVNDLEdBQ3pCQSxFQUFLNUMsVUFBVStDLFNBQVMsZUFDeEJNLEVBQVdFLEtBQUssU0FBV1gsRUFBS1ksYUFBYSxlQUM3Q0wsRUFBUVAsRUFBS1ksYUFBYSxpQkFJbEMzRSxLQUFLb0QsWUFBWVUsUUFBUSxTQUFTQyxHQUM5QixJQUFJQyxFQUFTRCxFQUFLcEQsUUFBUSx3QkFDdEJvRCxFQUFLNUMsVUFBVStDLFNBQVMsZUFDeEJNLEVBQVdFLEtBQUssUUFBVVYsRUFBT1csYUFBYSxjQUM5Q0gsRUFBV0UsS0FBSyxZQUFjVixFQUFPVyxhQUFhLG1CQUlqQyxLQUFyQnRCLEVBQVdmLE9BQ1hrQyxFQUFXRSxLQUFLLFVBQVlyQixFQUFXZixPQUczQ2lDLEVBQVcsSUFBTUMsRUFBV0ksS0FBSyxLQUloQixJQUFJQyxFQUFlTixHQUN6Qk8sV0FBV1IsR0FHdEIsSUFBSVMsRUFBYyxJQUFJQyxFQUFnQixZQUFhLE1BQU9iLFFBRTVDckMsSUFBVnNDLEVBQ0FXLEVBQVlFLFFBRVpDLEVBQVlDLGdCQUNabkYsS0FBSzRELFlBQWN6RCxXQUFXLFdBQzFCNEUsRUFBWUUsUUFDYmIsSUFHUGdCLFFBQVFDLElBQUlkLEtBeEtaLENBQUFsQyxJQUFBLE9BQUFDLE1BQUEsV0E2S0EsSUFBSWIsRUFBT3pCLEtBQ1hBLEtBQUtvRCxZQUFZVSxRQUFRLFNBQVNDLEdBQzlCQSxFQUFLeEQsaUJBQWlCLFFBQVMsV0FDdkJ3RCxFQUFLNUMsVUFBVStDLFNBQVN6QyxFQUFLNkIsY0FDN0I3QixFQUFLNkQsWUFBWXRGLE9BSWpCeUIsRUFBSzhELHVCQUNMOUQsRUFBSytELGdCQUFnQnhGLE9BSHJCeUIsRUFBS2dFLGlCQUFnQixPQVVqQ3pGLEtBQUtrRCxXQUFXWSxRQUFRLFNBQVNDLEdBQzdCQSxFQUFLeEQsaUJBQWlCLFFBQVMsU0FBU21GLEdBQ3BDQSxFQUFNQyxpQkFDRDNGLEtBQUttQixVQUFVK0MsU0FBUyxlQUN6QnpDLEVBQUttRSxhQUFhNUYsTUFFbEJ5QixFQUFLZ0UsaUJBQWdCLFFBS2pDekYsS0FBS3FELFdBQVdvQixxQkFBcUIsU0FBUyxHQUFHbEUsaUJBQWlCLFFBQVMsV0FFdkVrQixFQUFLZ0UsaUJBQWdCLEVBQU0sT0FHL0J6RixLQUFLMkQsZUFBZTFCLGlCQUFpQix5QkFBeUIsR0FBRzFCLGlCQUFpQixRQUFTLFNBQVNtRixHQUNoR0EsRUFBTUMsaUJBQ05sRSxFQUFLZ0UsaUJBQWdCLFNBL016QjVDLEVBQUEsR0FvTkZnQyxFQXBORSxXQXFOSixTQUFBQSxFQUFZZ0IsR0FBS2hFLGdCQUFBN0IsS0FBQTZFLEdBQ2I3RSxLQUFLOEYsS0FBT0QsRUFDWjdGLEtBQUsrRixZQUFjekYsT0FBTzBGLFFBdk4xQixPQUFBNUQsYUFBQXlDLEVBQUEsQ0FBQSxDQUFBeEMsSUFBQSxhQUFBQyxNQUFBLFNBME5PZ0MsR0FDSEEsSUFBVXRFLEtBQUsrRixZQUFZRSxNQUMzQmpHLEtBQUsrRixZQUFZRyxhQUFhNUIsRUFBT0EsRUFBT3RFLEtBQUs4RixNQUVqRDlGLEtBQUsrRixZQUFZSSxVQUFVN0IsRUFBT0EsRUFBT3RFLEtBQUs4RixRQTlObEQsQ0FBQXpELElBQUEsY0FBQUMsTUFBQSxTQWtPUWlDLFFBbE9STSxFQUFBLEdBdU9GRyxFQXZPRSxXQXdPSixTQUFBQSxFQUFZYSxFQUFLTyxFQUFNakMsR0FBZXRDLGdCQUFBN0IsS0FBQWdGLEdBQ2xDaEYsS0FBSzhGLEtBQU9ELEVBQ1o3RixLQUFLcUcsTUFBUUQsRUFDYnBHLEtBQUtzRyxlQUFpQm5DLEVBQ3RCbkUsS0FBS3VHLEtBQU8sSUFBSUMsZUE1T2hCLE9BQUFwRSxhQUFBNEMsRUFBQSxDQUFBLENBQUEzQyxJQUFBLFlBQUFDLE1BQUEsV0FnUEE0QyxFQUFZQyxrQkFoUFosQ0FBQTlDLElBQUEsWUFBQUMsTUFBQSxXQW9QQSxJQUFJbUUsRUFBU0MsS0FBS0MsTUFBTTNHLEtBQUs0RyxXQUVQLElBQWxCekMsZUFDQWUsRUFBWTJCLFlBQVlKLEVBQU9oRSxPQUMvQnlDLEVBQVk0QixtQkFBbUJMLEVBQU9NLFdBRXRDN0IsRUFBWThCLFlBQVlQLEVBQU9NLFVBR25DN0IsRUFBWStCLGdCQUVaN0IsUUFBUUMsSUFBSW9CLEtBL1BaLENBQUFwRSxJQUFBLDJCQUFBQyxNQUFBLFdBb1FBLElBQUltRSxFQUFTQyxLQUFLQyxNQUFNM0csS0FBSzRHLFVBRTdCMUIsRUFBWTJCLFlBQVlKLEVBQU9oRSxPQUMvQnlDLEVBQVk0QixtQkFBbUJMLEVBQU9NLFVBRXRDN0IsRUFBWStCLGdCQUVaN0IsUUFBUUMsSUFBSW9CLEtBM1FaLENBQUFwRSxJQUFBLHVCQUFBQyxNQUFBLFdBK1FBLElBQUltRSxFQUFTQyxLQUFLQyxNQUFNM0csS0FBSzRHLFVBRTdCMUIsRUFBWThCLFlBQVlQLEVBQU9NLFVBRS9CN0IsRUFBWStCLGdCQUVaN0IsUUFBUUMsSUFBSW9CLEtBclJaLENBQUFwRSxJQUFBLE9BQUFDLE1BQUEsU0F5UkM0RSxHQUNELElBQUkvQyxFQUFnQm5FLEtBQUtzRyxlQUNyQjdFLEVBQU96QixLQUVYQSxLQUFLdUcsS0FBS2hHLGlCQUFpQixXQUFZUCxLQUFLbUgsV0FBVyxHQUN2RG5ILEtBQUt1RyxLQUFLaEcsaUJBQWlCLFFBQ0QsSUFBbEI0RCxFQUNPMUMsRUFBSzJGLHlCQUVMM0YsRUFBSzRGLHNCQUVkLEdBRTJCLFFBQTdCckgsS0FBS3FHLE1BQU1pQixlQUVYdEgsS0FBS3VHLEtBQUtnQixLQUFLdkgsS0FBS3FHLE1BQU9yRyxLQUFLOEYsTUFDaEM5RixLQUFLdUcsS0FBS3RCLE9BRVZHLFFBQVFDLElBQUksUUFDd0IsU0FBN0JyRixLQUFLcUcsTUFBTWlCLGNBQ2xCbEMsUUFBUUMsSUFBSSxRQUVaRCxRQUFRQyxJQUFJLGFBL1NoQkwsRUFBQSxHQXFUSkUsRUFBYyxJQUFJMUQsRUFBUTFCLFNBQVNtQyxpQkFBaUIsWUFBWSxHQUFJLGlCQUFrQixtQkFBb0IsYUFFMUd1RixFQUFTLElBQUkzRSxFQUFPL0MsU0FBU21DLGlCQUFpQiwwQkFBMEIsR0FBSW5DLFNBQVNtQyxpQkFBaUIsbUJBQW1CLEdBQUluQyxTQUFTbUMsaUJBQWlCLGtCQUFrQixJQUs3SzNCLE9BQU9rSCxPQUFTQSxFQTVUbkIsR0NDZ0IzSCxFQUFFLHNCQUVSRSxHQUFHLFFBQVMsU0FBUzBILEdBQ3hCQSxFQUFFOUIsaUJBQ0Y5RixFQUFFRyxNQUFNVyxRQUFRLGdCQUFnQkMsS0FBSyxxQkFBcUI4RyxZQUFZLE9DSDFFcEgsT0FBT0MsaUJBQWlCLE9BQVEsV0FFNUIsR0FBSVYsRUFBRSwwQkFBMEJXLE9BQVEsQ0FBQSxJQWlDM0JtSCxFQUFULFdBQ0lDLEVBQW9CQyxFQUFXQyxXQUFXQyxLQUMxQ0MsRUFBbUJILEVBQVdDLFdBQVdHLElBQ3ZCSixFQUFXSyxhQUNWTCxFQUFXTSxjQUU5QkMsRUFBU0MsSUFBSSxDQUFDTixLQUFTSCxFQUFtQkssSUFBUUQsRUFBa0JNLE1BQVUsRUFBR0MsT0FBVyxLQXJDNUZDLEVBQVczSSxFQUFFLCtCQUliZ0ksR0FIT2hJLEVBQUUsK0JBRUVBLEVBQUUsK0JBQ0FBLEVBQUUsMENBQ2Z1SSxFQUFXdkksRUFBRSx1QkFDYitILEVBQW9CQyxFQUFXQyxXQUFXQyxLQUMxQ0MsRUFBbUJILEVBQVdDLFdBQVdHLElBSXpDUSxHQUhrQlosRUFBV0ssYUFDVkwsRUFBV00sZUFFdEIsR0FDWkssRUFBU0UsTUFDUCxXQUNFLElBQUlDLEVBQWlCOUksRUFBRUcsTUFBTThILFdBQVdDLEtBQ3BDYSxFQUFnQi9JLEVBQUVHLE1BQU04SCxXQUFXRyxJQUNuQ1ksRUFBZWhKLEVBQUVHLE1BQU1rSSxhQUN2QlksRUFBZ0JqSixFQUFFRyxNQUFNbUksY0FDNUJDLEVBQVNDLElBQUksQ0FBQ04sS0FBU1ksRUFBZ0JWLElBQVFXLEVBQWVOLE1BQVVPLEVBQWNOLE9BQVdPLElBQ2pHTCxHQUFRLEdBRVYsV0FDRXRJLFdBQVcsV0FDTHNJLEdBQ0ZMLEVBQVNDLElBQUksQ0FBQ04sS0FBU0gsRUFBbUJLLElBQVFELEVBQWtCTSxNQUFVLEVBQUdDLE9BQVcsS0FFN0YsS0FDSEUsR0FBUSxJQWFaNUksRUFBRVMsUUFBUXlJLE9BQU8sV0FDYnBCLE1BRUpBLE9DL0NSckgsT0FBT0MsaUJBQWlCLE9BQVEsV0FFNUJWLEVBQUUseUJBQXlCbUosU0FBUyxXQUNaLEtBQWxCbkosRUFBRUcsTUFBTWlKLE1BQ1ZwSixFQUFFRyxNQUFNZ0UsU0FBUzlELFNBQVMsU0FHMUJMLEVBQUVHLE1BQU1nRSxTQUFTNUQsWUFBWSxhQ1R4QyxXQUVHLElBQUk4SSxFQUFRcEosU0FBU29CLGVBQWUsU0FDcEMsR0FBYVksTUFBVG9ILEVBQ3VCLElBQUlDLFNBQVNELEdBSjNDLEdDQ0dySixFQUFFQyxVQUFVQyxHQUFHLFFBQVMsc0JBQXVCLFdBQzNDRixFQUFFRyxNQUFNVyxRQUFRLGVBQWVDLEtBQUssdUJBQXVCd0ksWUFBWSxhQUN2RXZKLEVBQUVHLE1BQU1XLFFBQVEsZUFBZUMsS0FBSyx3QkFBd0I4RyxZQUFZIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiOyhmdW5jdGlvbigpIHtcclxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuYnV0dG9uLS1iYXNrZXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2FuaW1hdGUnKSkge1xyXG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhbmltYXRlJyk7XHJcbiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJidXR0b24tLWNoZWNrXCIpO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhcImJ1dHRvbi0tY2hlY2tcIik7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdhbmltYXRlJyk7XHJcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgMjAwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pKCk7XHJcbiIsIjsoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgaWYgKCQoJy5oci1zZWN0JykubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAkKFwiLmhyLXBhZ2luYXRpb25fX3N0ZXBcIikuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGhTdGVwID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhTdGVwLmhhc0NsYXNzKFwiaXMtYWN0aXZlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhTdGVwLmNsb3Nlc3QoJy5oci1zZWN0JykuZmluZChcIi5oci1wYWdpbmF0aW9uX19zdGVwXCIpLnJlbW92ZUNsYXNzKFwiaXMtYWN0aXZlXCIpLnJlbW92ZUNsYXNzKFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoU3RlcC5hZGRDbGFzcyhcImlzLWFjdGl2ZVwiKS5hZGRDbGFzcyhcImJ1dHRvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFnaUluZGV4ID0gdGhTdGVwLmF0dHIoXCJkYXRhLWluZGV4XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2xpZGVyU2xpZGVzID0gdGhTdGVwLmNsb3Nlc3QoXCIuaHItc2VjdFwiKS5maW5kKFwiLmhyLXNsaWRlci1zbGlkZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzbGlkZXJTbGlkZXMucmVtb3ZlQ2xhc3MoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyU2xpZGVzLmVhY2goZnVuY3Rpb24ocGFnaUluZGV4LCB0aFN0ZXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcImRhdGEtaW5kZXhcIikgPT0gJChcIi5oci1wYWdpbmF0aW9uX19zdGVwLmlzLWFjdGl2ZVwiKS5hdHRyKFwiZGF0YS1pbmRleFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcImlzLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxufSkoKTtcclxuIiwiOyhmdW5jdGlvbigpIHtcclxuICAgIGxldCBtZW51QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lbnUtYnV0dG9uJyk7XHJcblxyXG4gICAgbWVudUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG1lbnVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbmVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB3aW5kb3cub25yZXNpemUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBtZW51QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW5lZCcpO1xyXG4gICAgfVxyXG4gICAgd2luZG93Lm9uc2Nyb2xsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgbWVudUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuZWQnKTtcclxuICAgIH1cclxufSkoKTtcclxuIiwiOyhmdW5jdGlvbigpe1xyXG5cclxuICAgIGNsYXNzIENhdGFsb2cge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKHNlbGYsIHRpdGxlQ2xhc3MsIHByb2R1Y3RzQ29udGFpbmVyQ2xhc3MsIHByb2R1Y3RzUHJlbG9hZGVyQ2xhc3Mpe1xyXG4gICAgICAgICAgICBpZiAoc2VsZiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5fc2VsZiA9IHNlbGY7XHJcbiAgICAgICAgICAgIHRoaXMuX3RpdGxlID0gdGhpcy5fc2VsZi5xdWVyeVNlbGVjdG9yQWxsKFwiLlwiICsgdGl0bGVDbGFzcylbMF07XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2R1Y3RzID0gdGhpcy5fc2VsZi5xdWVyeVNlbGVjdG9yQWxsKFwiLlwiICsgcHJvZHVjdHNDb250YWluZXJDbGFzcylbMF07XHJcbiAgICAgICAgICAgIHRoaXMucHJlbG9hZGVyID0gdGhpcy5fc2VsZi5xdWVyeVNlbGVjdG9yQWxsKFwiLlwiICsgcHJvZHVjdHNQcmVsb2FkZXJDbGFzcylbMF07XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgX2NsZWFuUHJvZHVjdHMoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2R1Y3RzLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwbGF5UHJlbG9hZGVyKCkge1xyXG4gICAgICAgICAgICB0aGlzLnByZWxvYWRlci5jbGFzc0xpc3QuYWRkKFwicHJlbG9hZGVyLS1hY3RpdmVcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdG9wUHJlbG9hZGVyKCkge1xyXG4gICAgICAgICAgICB0aGlzLnByZWxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKFwicHJlbG9hZGVyLS1hY3RpdmVcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB1cGRhdGVUaXRsZSh0aXRsZSkge1xyXG4gICAgICAgICAgICB0aGlzLl90aXRsZS5pbm5lckhUTUwgPSB0aXRsZTtcclxuICAgICAgICAgICAgdGhpcy5fdGl0bGUuc2V0QXR0cmlidXRlKFwiZGF0YS1uYW1lXCIsIHRpdGxlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHVwZGF0ZUxpc3RQcm9kdWN0cyhwcm9kdWN0cykge1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9kdWN0cy5pbm5lckhUTUwgPSBwcm9kdWN0cztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFkZFByb2R1Y3RzKHByb2R1Y3RzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2R1Y3RzLmluc2VydEFkamFjZW50SFRNTChcImJlZm9yZWVuZFwiLCBwcm9kdWN0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsYXNzIEZpbHRlciB7XHJcbiAgICAgICAgY29uc3RydWN0b3IoY29udGFpbmVyQnJhbmRzLCBjb250YWluZXJGaWx0ZXIsIGNvbnRhaW5lck1vcmUpIHtcclxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lckJyYW5kcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lckZpbHRlciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lck1vcmUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9jb250YWluZXJCcmFuZHMgPSBjb250YWluZXJCcmFuZHM7XHJcbiAgICAgICAgICAgIHRoaXMuX2JyYW5kSXRlbSA9IHRoaXMuX2NvbnRhaW5lckJyYW5kcy5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2ctbmF2X19jb250cm9scy1saW5rXCIpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fY29udGFpbmVyRmlsdGVyID0gY29udGFpbmVyRmlsdGVyO1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJJdGVtID0gdGhpcy5fY29udGFpbmVyRmlsdGVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2F0YWxvZy1maWx0ZXJfX2NvbC1idG5cIik7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoSXRlbSA9IHRoaXMuX2NvbnRhaW5lckZpbHRlci5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2ctZmlsdGVyX19mb3JtXCIpWzBdO1xyXG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVDbGFzcyA9IFwiaXMtYWN0aXZlXCI7XHJcbiAgICAgICAgICAgIHRoaXMuX3NvcnRUeXBlQXNjID0ge1xyXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwic29ydC1kb3duXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhU29ydDogXCJhc2NcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0aGlzLl9zb3J0VHlwZURlc2MgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzczogXCJzb3J0LXVwXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhU29ydDogXCJkZXNjXCJcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fY29udGFpbmVyTW9yZSA9IGNvbnRhaW5lck1vcmU7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnRpbWVPdXRBamF4O1xyXG4gICAgICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9jbGVhbkNsYXNzRmlsdGVyQWxsKCkge1xyXG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJJdGVtLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50ID0gaXRlbS5jbG9zZXN0KFwiLmNhdGFsb2ctZmlsdGVyX19jb2xcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShzZWxmLl9hY3RpdmVDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKHNlbGYuX3NvcnRUeXBlQXNjLmNsYXNzKTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmVtb3ZlQXR0cmlidXRlKFwiZGF0YS1zb3J0XCIpO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfYWRkQ2xhc3NGaWx0ZXIoaXRlbSkge1xyXG4gICAgICAgICAgICBsZXQgcGFyZW50ID0gaXRlbS5jbG9zZXN0KFwiLmNhdGFsb2ctZmlsdGVyX19jb2xcIik7XHJcblxyXG4gICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQodGhpcy5fYWN0aXZlQ2xhc3MpO1xyXG4gICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQodGhpcy5fc29ydFR5cGVBc2MuY2xhc3MpO1xyXG5cclxuICAgICAgICAgICAgcGFyZW50LnNldEF0dHJpYnV0ZShcImRhdGEtc29ydFwiLCB0aGlzLl9zb3J0VHlwZUFzYy5kYXRhU29ydCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfdG9vZ2xlU29ydChpdGVtKSB7XHJcbiAgICAgICAgICAgIGxldCBwYXJlbnQgPSBpdGVtLmNsb3Nlc3QoXCIuY2F0YWxvZy1maWx0ZXJfX2NvbFwiKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLl9zb3J0VHlwZUFzYy5jbGFzcykpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zb3J0VHlwZUFzYy5jbGFzcyk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQodGhpcy5fc29ydFR5cGVEZXNjLmNsYXNzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwYXJlbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1zb3J0XCIsIHRoaXMuX3NvcnRUeXBlRGVzYy5kYXRhU29ydCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc29ydFR5cGVEZXNjLmNsYXNzKTtcclxuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCh0aGlzLl9zb3J0VHlwZUFzYy5jbGFzcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcGFyZW50LnNldEF0dHJpYnV0ZShcImRhdGEtc29ydFwiLCB0aGlzLl9zb3J0VHlwZUFzYy5kYXRhU29ydCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfc2VsZWN0QnJhbmQoaXRlbSkge1xyXG4gICAgICAgICAgICBpZiAoIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKFwiaXMtYWN0aXZlXCIpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2JyYW5kSXRlbS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChcImlzLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX3F1ZXJ5Rm9ybWF0aW9uKHByb2R1Y3RVcGRhdGUsIGRlbGF5KSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVPdXRBamF4KTtcclxuICAgICAgICAgICAgLy/QnNC10YLQvtC0INGE0L7RgNC80LjRgNC+0LLQsNC90LjRjyBnZXQg0LfQsNC/0YDQvtGB0LBcclxuICAgICAgICAgICAgbGV0IGFycmF5UXVlcnkgPSBbXSxcclxuICAgICAgICAgICAgICAgIHNlYXJjaEl0ZW0gPSB0aGlzLnNlYXJjaEl0ZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbnB1dFwiKVswXSxcclxuICAgICAgICAgICAgICAgIGJyYW5kLFxyXG4gICAgICAgICAgICAgICAgZ2V0UXVlcnk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9icmFuZEl0ZW0uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJpcy1hY3RpdmVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnJheVF1ZXJ5LnB1c2goXCJicmFuZD1cIiArIGl0ZW0uZ2V0QXR0cmlidXRlKFwiZGF0YS1icmFuZFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJhbmQgPSBpdGVtLmdldEF0dHJpYnV0ZShcImRhdGEtYnJhbmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fZmlsdGVySXRlbS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGxldCBwYXJlbnQgPSBpdGVtLmNsb3Nlc3QoXCIuY2F0YWxvZy1maWx0ZXJfX2NvbFwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucyhcImlzLWFjdGl2ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFycmF5UXVlcnkucHVzaChcInNvcnQ9XCIgKyBwYXJlbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1zb3J0XCIpKTtcclxuICAgICAgICAgICAgICAgICAgICBhcnJheVF1ZXJ5LnB1c2goXCJzb3J0VHlwZT1cIiArIHBhcmVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWZpbHRlclwiKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNlYXJjaEl0ZW0udmFsdWUgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGFycmF5UXVlcnkucHVzaChcInNlYXJjaD1cIiArIHNlYXJjaEl0ZW0udmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBnZXRRdWVyeSA9IFwiP1wiICsgYXJyYXlRdWVyeS5qb2luKFwiJlwiKTtcclxuXHJcbiAgICAgICAgICAgIC8vVG9kbzog0LfQtNC10YHRjCDQtNC+0LvQttC10L0g0LLRi9C30YvQstCw0YLRjNGB0Y8gYWpheCDQuCDQv9GA0LjQvdC40LzQsNGC0YwgZ2V0INGB0YLRgNC+0LrRg1xyXG4gICAgICAgICAgICAvL1RvZG86INC30LTQtdGB0Ywg0LTQvtC70LbQtdC9INCy0YvQt9GL0LLQsNGC0YzRgdGPIGhpc3RvcnlBUEkg0LTQu9GPINGB0L7RhdGA0LDQvdC10L3QuNGPINC40YHRgtC+0YDQuNC4INGBIGdldCDQt9Cw0L/RgNC+0YHQsNC80LhcclxuICAgICAgICAgICAgbGV0IGhpc3RvcnlPYmogPSBuZXcgSGlzdG9yeUNvbnJ0b2woZ2V0UXVlcnkpO1xyXG4gICAgICAgICAgICBoaXN0b3J5T2JqLnNldEhpc3RvcnkoYnJhbmQpO1xyXG5cclxuICAgICAgICAgICAgLy/QotC10YHRgtC+0LLQvtC1IGFqYXgg0J3Rg9C20L3QviDQsdGD0LTQtdGCINGD0LrQsNC30YvQstCw0YLRjCDQvdC+0LLRi9C5INCw0LTRgNC10YFcclxuICAgICAgICAgICAgbGV0IGFqYXhDb25uZWN0ID0gbmV3IEFqYXhHZXRQcm9kdWN0cyhcInRlc3QuanNvblwiLCBcImdldFwiLCBwcm9kdWN0VXBkYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkZWxheSA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgIGFqYXhDb25uZWN0LnNlbmQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNhdGFsb2RUZXN0LnBsYXlQcmVsb2FkZXIoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZU91dEFqYXggPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgYWpheENvbm5lY3Quc2VuZCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZGVsYXkpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGdldFF1ZXJ5KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbml0KCkge1xyXG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgIHRoaXMuX2ZpbHRlckl0ZW0uZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucyhzZWxmLl9hY3RpdmVDbGFzcykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdG9vZ2xlU29ydCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/QktGL0LfQvtCyINC80LXRgtC+0LTQsCDRhNC+0YDQvNC40YDQvtCy0LDQvdC40Y8gR2V0INC30LDQv9GA0L7RgdCwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3F1ZXJ5Rm9ybWF0aW9uKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2NsZWFuQ2xhc3NGaWx0ZXJBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fYWRkQ2xhc3NGaWx0ZXIodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v0JLRi9C30L7QsiDQvNC10YLQvtC00LAg0YTQvtGA0LzQuNGA0L7QstCw0L3QuNGPIEdldCDQt9Cw0L/RgNC+0YHQsFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9xdWVyeUZvcm1hdGlvbih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9icmFuZEl0ZW0uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcImlzLWFjdGl2ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZWxlY3RCcmFuZCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/QktGL0LfQvtCyINC80LXRgtC+0LTQsCDRhNC+0YDQvNC40YDQvtCy0LDQvdC40Y8gR2V0INC30LDQv9GA0L7RgdCwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3F1ZXJ5Rm9ybWF0aW9uKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICB0aGlzLnNlYXJjaEl0ZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbnB1dFwiKVswXS5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvL9CS0YvQt9C+0LIg0LzQtdGC0L7QtNCwINGE0L7RgNC80LjRgNC+0LLQsNC90LjRjyBHZXQg0LfQsNC/0YDQvtGB0LBcclxuICAgICAgICAgICAgICAgIHNlbGYuX3F1ZXJ5Rm9ybWF0aW9uKHRydWUsIDEwMDApO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fY29udGFpbmVyTW9yZS5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2dfX21vcmUtYnV0dG9uXCIpWzBdLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuX3F1ZXJ5Rm9ybWF0aW9uKGZhbHNlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsYXNzIEhpc3RvcnlDb25ydG9sIHtcclxuICAgICAgICBjb25zdHJ1Y3Rvcih1cmwpIHtcclxuICAgICAgICAgICAgdGhpcy5fdXJsID0gdXJsO1xyXG4gICAgICAgICAgICB0aGlzLl9oaXN0b3J5T2JqID0gd2luZG93Lmhpc3Rvcnk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRIaXN0b3J5KGJyYW5kKSB7XHJcbiAgICAgICAgICAgIGlmIChicmFuZCA9PT0gdGhpcy5faGlzdG9yeU9iai5zdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faGlzdG9yeU9iai5yZXBsYWNlU3RhdGUoYnJhbmQsIGJyYW5kLCB0aGlzLl91cmwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faGlzdG9yeU9iai5wdXNoU3RhdGUoYnJhbmQsIGJyYW5kLCB0aGlzLl91cmwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZWFkSGlzdG9yeShnZXRRdWVyeSkge1xyXG4gICAgICAgICAgICAvL1RvZG86INC30LTQtdGB0Ywg0L3Rg9C20L3QviDQv9Cw0YDRgdC40YLRjCBnZXQg0LfQsNC/0YDQvtGBINC4INC/0YDQtdCy0L7QtNC40YLRjCDRgdC+0YHRgtC+0Y/QvdC40LUg0YHRgtGA0LDQvdC40YbRiyDQuiDQsNC60YLRg9Cw0LvRjNC90L7QvNGDINCy0LjQtNGDXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsYXNzIEFqYXhHZXRQcm9kdWN0cyB7XHJcbiAgICAgICAgY29uc3RydWN0b3IodXJsLCB0eXBlLCBwcm9kdWN0VXBkYXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3VybCA9IHVybDtcclxuICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2R1Y3RVcGRhdGUgPSBwcm9kdWN0VXBkYXRlO1xyXG4gICAgICAgICAgICB0aGlzLmFqYXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9wcm9ncmVzcygpIHtcclxuICAgICAgICAgICAgY2F0YWxvZFRlc3QucGxheVByZWxvYWRlcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX2NvbXBsZXRlKCkge1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9kdWN0VXBkYXRlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXRhbG9kVGVzdC51cGRhdGVUaXRsZShyZXN1bHQudGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgY2F0YWxvZFRlc3QudXBkYXRlTGlzdFByb2R1Y3RzKHJlc3VsdC5lbGVtZW50cyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjYXRhbG9kVGVzdC5hZGRQcm9kdWN0cyhyZXN1bHQuZWxlbWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjYXRhbG9kVGVzdC5zdG9wUHJlbG9hZGVyKCk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9jb21wbGV0ZVVwZGF0ZVBycG9kdWN0cygpIHtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IEpTT04ucGFyc2UodGhpcy5yZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICBjYXRhbG9kVGVzdC51cGRhdGVUaXRsZShyZXN1bHQudGl0bGUpO1xyXG4gICAgICAgICAgICBjYXRhbG9kVGVzdC51cGRhdGVMaXN0UHJvZHVjdHMocmVzdWx0LmVsZW1lbnRzKTtcclxuXHJcbiAgICAgICAgICAgIGNhdGFsb2RUZXN0LnN0b3BQcmVsb2FkZXIoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfY29tcGxldGVBZGRQcm9kdWN0cygpIHtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IEpTT04ucGFyc2UodGhpcy5yZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICBjYXRhbG9kVGVzdC5hZGRQcm9kdWN0cyhyZXN1bHQuZWxlbWVudHMpO1xyXG5cclxuICAgICAgICAgICAgY2F0YWxvZFRlc3Quc3RvcFByZWxvYWRlcigpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBzZW5kKGRhdGEpIHtcclxuICAgICAgICAgICAgbGV0IHByb2R1Y3RVcGRhdGUgPSB0aGlzLl9wcm9kdWN0VXBkYXRlLFxyXG4gICAgICAgICAgICAgICAgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFqYXguYWRkRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsIHRoaXMuX3Byb2dyZXNzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWpheC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvZHVjdFVwZGF0ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb21wbGV0ZVVwZGF0ZVBycG9kdWN0cztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbXBsZXRlQWRkUHJvZHVjdHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pKCksIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl90eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZ2V0XCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmFqYXgub3Blbih0aGlzLl90eXBlLCB0aGlzLl91cmwpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hamF4LnNlbmQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldFwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwicG9zdFwiKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInBvc3RcIik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBsZXQgY2F0YWxvZFRlc3QgPSBuZXcgQ2F0YWxvZyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2dcIilbMF0sIFwiY2F0YWxvZ19fdGl0bGVcIiwgXCJjYXRhbG9nX19wcm9kdWN0XCIsIFwicHJlbG9hZGVyXCIpO1xyXG5cclxuICAgIGxldCBmaWx0ZXIgPSBuZXcgRmlsdGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2F0YWxvZy1uYXZfX2NvbnRyb2xzXCIpWzBdLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2ctZmlsdGVyXCIpWzBdLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2dfX21vcmVcIilbMF0pO1xyXG5cclxuXHJcbiAgICAvL9Ci0LXRgdGCXHJcbiAgICAvLyB3aW5kb3cuZGl2QXJyYXkgPSBkaXZBcnJheTtcclxuICAgIHdpbmRvdy5maWx0ZXIgPSBmaWx0ZXI7XHJcbn0pKCk7XHJcbiIsIjsoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgYnV0dG9uID0gJCgnLmZvb3Rlcl9fY29sLXRpdGxlJyk7XHJcblxyXG4gICAgYnV0dG9uLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcuZm9vdGVyX19jb2wnKS5maW5kKCcuZm9vdGVyX19jb2wtbGlzdCcpLnNsaWRlVG9nZ2xlKDMwMCk7XHJcbiAgICB9KTtcclxufSkoKTtcclxuIiwiOyhmdW5jdGlvbigpIHtcclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICBpZiAoJCgnLmNhdGFsb2ctbmF2X19jb250cm9scycpLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIG1lbnVMaW5rID0gJCgnLmNhdGFsb2ctbmF2X19jb250cm9scy1saW5rJyksXHJcbiAgICAgICAgICAgICAgICBtZW51ID0gJCgnLmNhdGFsb2ctbmF2X19jb250cm9scy1saXN0Jyk7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWVudUl0ZW0gPSAkKCcuY2F0YWxvZy1uYXZfX2NvbnRyb2xzLWl0ZW0nKSxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUxpbmsgPSAkKCcuY2F0YWxvZy1uYXZfX2NvbnRyb2xzLWxpbmsuaXMtYWN0aXZlJyksXHJcbiAgICAgICAgICAgICAgICBob3ZlckJveCA9ICQoJy5jYXRhbG9nLW5hdl9faG92ZXInKSxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUxpbmtQb3NMZWZ0ID0gYWN0aXZlTGluay5wb3NpdGlvbigpLmxlZnQsXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVMaW5rUG9zVG9wID0gYWN0aXZlTGluay5wb3NpdGlvbigpLnRvcCxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUxpbmtXaWR0aCA9IGFjdGl2ZUxpbmsuaW5uZXJXaWR0aCgpLFxyXG4gICAgICAgICAgICAgICAgYWN0aXZlTGlua0hlaWdodCA9IGFjdGl2ZUxpbmsuaW5uZXJIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjaGVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtZW51TGluay5ob3ZlcihcclxuICAgICAgICAgICAgICBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdMaW5rUG9zTGVmdCA9ICQodGhpcykucG9zaXRpb24oKS5sZWZ0LFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld0xpbmtQb3NUb3AgPSAkKHRoaXMpLnBvc2l0aW9uKCkudG9wLFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld0xpbmtXaWR0aCA9ICQodGhpcykuaW5uZXJXaWR0aCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld0xpbmtIZWlnaHQgPSAkKHRoaXMpLmlubmVySGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICBob3ZlckJveC5jc3MoeydsZWZ0JyA6IG5ld0xpbmtQb3NMZWZ0LCAndG9wJyA6IG5ld0xpbmtQb3NUb3AsICd3aWR0aCcgOiBuZXdMaW5rV2lkdGgsICdoZWlnaHQnIDogbmV3TGlua0hlaWdodH0pO1xyXG4gICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJCb3guY3NzKHsnbGVmdCcgOiBhY3RpdmVMaW5rUG9zTGVmdCwgJ3RvcCcgOiBhY3RpdmVMaW5rUG9zVG9wLCAnd2lkdGgnIDogMCwgJ2hlaWdodCcgOiAwfSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgY2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2l6ZVBvcygpIHtcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUxpbmtQb3NMZWZ0ID0gYWN0aXZlTGluay5wb3NpdGlvbigpLmxlZnQsXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVMaW5rUG9zVG9wID0gYWN0aXZlTGluay5wb3NpdGlvbigpLnRvcCxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUxpbmtXaWR0aCA9IGFjdGl2ZUxpbmsuaW5uZXJXaWR0aCgpLFxyXG4gICAgICAgICAgICAgICAgYWN0aXZlTGlua0hlaWdodCA9IGFjdGl2ZUxpbmsuaW5uZXJIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBob3ZlckJveC5jc3MoeydsZWZ0JyA6IGFjdGl2ZUxpbmtQb3NMZWZ0LCAndG9wJyA6IGFjdGl2ZUxpbmtQb3NUb3AsICd3aWR0aCcgOiAwLCAnaGVpZ2h0JyA6IDB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJlc2l6ZVBvcygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmVzaXplUG9zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG5cclxufSkoKTtcclxuIiwiOyhmdW5jdGlvbigpIHtcclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAkKCcuZGVsaXZlcnlfX2Zvcm0taW5wdXQnKS5mb2N1c291dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgaWYgKCQodGhpcykudmFsKCkgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoJ3ZhbHVlJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygndmFsdWUnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbn0pKCk7XHJcbiIsIjsoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgbGV0IHNjZW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjZW5lJyk7XHJcbiAgICBpZiAoc2NlbmUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgbGV0IHBhcmFsbGF4SW5zdGFuY2UgPSBuZXcgUGFyYWxsYXgoc2NlbmUpO1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiOyhmdW5jdGlvbigpIHtcclxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuc2xpZGUtaW5mb19fYnV0dG9uJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcuc2xpZGUtaW5mbycpLmZpbmQoJy5zbGlkZS1pbmZvX19idXR0b24nKS50b2dnbGVDbGFzcygnaXMtYWN0aXZlJyk7XHJcbiAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcuc2xpZGUtaW5mbycpLmZpbmQoJy5zbGlkZS1pbmZvX19jb250ZW50Jykuc2xpZGVUb2dnbGUoMzAwKTtcclxuICAgIH0pO1xyXG59KSgpO1xyXG4iXX0=
