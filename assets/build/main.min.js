"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),t}$(document).on("click",".button--basket",function(){$(this).hasClass("animate")||($(this).addClass("animate"),$(this).addClass("button--check"),setTimeout(function(){$(this).removeClass("button--check"),$(this).removeClass("animate")}.bind(this),2e3))}),window.addEventListener("load",function(){$(".hr-sect").length&&$(".hr-pagination__step").click(function(){var t=$(this);if(!t.hasClass("is-active")){t.closest(".hr-sect").find(".hr-pagination__step").removeClass("is-active").removeClass("button"),t.addClass("is-active").addClass("button"),t.attr("data-index");var e=t.closest(".hr-sect").find(".hr-slider-slide");e.removeClass("is-active"),e.each(function(t,e){$(this).attr("data-index")==$(".hr-pagination__step.is-active").attr("data-index")&&$(this).addClass("is-active")})}})}),function(){var t=document.getElementById("menu-button");t.addEventListener("click",function(){t.classList.toggle("opened")}),window.onresize=function(){t.classList.remove("opened")},window.onscroll=function(){t.classList.remove("opened")}}(),function(){var t=function(){function a(t,e,s,i){if(_classCallCheck(this,a),void 0===t)return!1;this._self=t,this._title=this._self.querySelectorAll("."+e)[0],this._products=this._self.querySelectorAll("."+s)[0],this.preloader=this._self.querySelectorAll("."+i)[0]}return _createClass(a,[{key:"_cleanProducts",value:function(){this._products.innerHTML=""}},{key:"playPreloader",value:function(){this.preloader.classList.add("preloader--active")}},{key:"stopPreloader",value:function(){this.preloader.classList.remove("preloader--active")}},{key:"updateTitle",value:function(t){this._title.innerHTML=t,this._title.setAttribute("data-name",t)}},{key:"updateListProducts",value:function(t){this._products.innerHTML=t}},{key:"addProducts",value:function(t){this._products.insertAdjacentHTML("beforeend",t)}}]),a}(),e=function(){function s(t,e){return _classCallCheck(this,s),void 0!==t&&(void 0!==e&&(this._containerBrands=t,this._brandItem=this._containerBrands.querySelectorAll(".catalog-nav__controls-link"),this._containerFilter=e,this._filterItem=this._containerFilter.querySelectorAll(".catalog-filter__col-btn"),this.searchItem=this._containerFilter.querySelectorAll(".catalog-filter__form")[0],this._activeClass="is-active",this._sortTypeAsc={class:"sort-down",dataSort:"asc"},this._sortTypeDesc={class:"sort-up",dataSort:"desc"},this.timeOutAjax,void this.init()))}return _createClass(s,[{key:"_cleanClassFilterAll",value:function(){var s=this;this._filterItem.forEach(function(t){var e=t.closest(".catalog-filter__col");t.classList.remove(s._activeClass),t.classList.remove(s._sortTypeAsc.class),e.removeAttribute("data-sort")})}},{key:"_addClassFilter",value:function(t){var e=t.closest(".catalog-filter__col");t.classList.add(this._activeClass),t.classList.add(this._sortTypeAsc.class),e.setAttribute("data-sort",this._sortTypeAsc.dataSort)}},{key:"_toogleSort",value:function(t){var e=t.closest(".catalog-filter__col");t.classList.contains(this._sortTypeAsc.class)?(t.classList.remove(this._sortTypeAsc.class),t.classList.add(this._sortTypeDesc.class),e.setAttribute("data-sort",this._sortTypeDesc.dataSort)):(t.classList.remove(this._sortTypeDesc.class),t.classList.add(this._sortTypeAsc.class),e.setAttribute("data-sort",this._sortTypeAsc.dataSort))}},{key:"_selectBrand",value:function(t){t.classList.contains("is-active")||(this._brandItem.forEach(function(t){t.classList.remove("is-active")}),t.classList.add("is-active"))}},{key:"_queryFormation",value:function(t){clearTimeout(this.timeOutAjax);var e,s,i=[],a=this.searchItem.getElementsByTagName("input")[0];this._brandItem.forEach(function(t){t.classList.contains("is-active")&&(i.push("brand="+t.getAttribute("data-brand")),e=t.getAttribute("data-brand"))}),this._filterItem.forEach(function(t){var e=t.closest(".catalog-filter__col");t.classList.contains("is-active")&&(i.push("sort="+e.getAttribute("data-sort")),i.push("sortType="+e.getAttribute("data-filter")))}),""!==a.value&&i.push("search="+a.value),s="?"+i.join("&"),new n(s).setHistory(e);var o=new l("test.json","get");void 0===t?o.send():(r.playPreloader(),this.timeOutAjax=setTimeout(function(){o.send()},t)),console.log(s)}},{key:"init",value:function(){var e=this;this._filterItem.forEach(function(t){t.addEventListener("click",function(){t.classList.contains(e._activeClass)?e._toogleSort(this):(e._cleanClassFilterAll(),e._addClassFilter(this)),e._queryFormation()})}),this._brandItem.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),this.classList.contains("is-active")||(e._selectBrand(this),e._queryFormation())})}),this.searchItem.getElementsByTagName("input")[0].addEventListener("input",function(){e._queryFormation(1e3)})}}]),s}(),n=function(){function e(t){_classCallCheck(this,e),this._url=t,this._historyObj=window.history}return _createClass(e,[{key:"setHistory",value:function(t){t===this._historyObj.state?this._historyObj.replaceState(t,t,this._url):this._historyObj.pushState(t,t,this._url)}},{key:"readHistory",value:function(t){}}]),e}(),l=function(){function s(t,e){_classCallCheck(this,s),this._url=t,this._type=e,this.ajax=new XMLHttpRequest}return _createClass(s,[{key:"_progress",value:function(){r.playPreloader()}},{key:"_complete",value:function(){var t=JSON.parse(this.response);r.updateTitle(t.title),r.updateListProducts(t.elements),r.stopPreloader(),console.log(t)}},{key:"send",value:function(t){this.ajax.addEventListener("progress",this._progress,!1),this.ajax.addEventListener("load",this._complete,!1),"get"===this._type.toLowerCase()?(this.ajax.open(this._type,this._url),this.ajax.send(),console.log("get")):"post"===this._type.toLowerCase()?console.log("post"):console.log("Error")}}]),s}(),r=new t(document.querySelectorAll(".catalog")[0],"catalog__title","catalog__product","preloader"),s=new e(document.querySelectorAll(".catalog-nav__controls")[0],document.querySelectorAll(".catalog-filter")[0]);window.filter=s}(),$(".footer__col-title").on("click",function(t){t.preventDefault(),$(this).closest(".footer__col").find(".footer__col-list").slideToggle(300)}),window.addEventListener("load",function(){if($(".catalog-nav__controls").length){var t=function(){i=s.position().left,o=s.position().top,s.innerWidth(),s.innerHeight(),a.css({left:i,top:o,width:0,height:0})},e=$(".catalog-nav__controls-link"),s=($(".catalog-nav__controls-list"),$(".catalog-nav__controls-item"),$(".catalog-nav__controls-link.is-active")),a=$(".catalog-nav__hover"),i=s.position().left,o=s.position().top,n=(s.innerWidth(),s.innerHeight(),!1);e.hover(function(){var t=$(this).position().left,e=$(this).position().top,s=$(this).innerWidth(),i=$(this).innerHeight();a.css({left:t,top:e,width:s,height:i}),n=!1},function(){setTimeout(function(){n&&a.css({left:i,top:o,width:0,height:0})},1e3),n=!0}),$(window).resize(function(){t()}),t()}}),window.addEventListener("load",function(){$(".delivery__form-input").focusout(function(){""!==$(this).val()?$(this).parent().addClass("value"):$(this).parent().removeClass("value")})}),function(){var t=document.getElementById("scene");if(null!=t)new Parallax(t)}(),$(document).on("click",".slide-info__button",function(){$(this).closest(".slide-info").find(".slide-info__button").toggleClass("is-active"),$(this).closest(".slide-info").find(".slide-info__content").slideToggle(300)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZFRvQmFza2V0LmpzIiwiYmFza2V0VGFicy5qcyIsImJ1cmdlci5qcyIsImNhdGFsb2dVcGRhdGVDbGFzcy5qcyIsImZvb3Rlck1lbnUuanMiLCJob3ZlclJvbGxlci5qcyIsImxhYmVsRm9ybS5qcyIsInBhcmFsbGF4LmpzIiwic2hvd01vcmUuanMiXSwibmFtZXMiOlsiJCIsImRvY3VtZW50Iiwib24iLCJ0aGlzIiwiaGFzQ2xhc3MiLCJhZGRDbGFzcyIsInNldFRpbWVvdXQiLCJyZW1vdmVDbGFzcyIsImJpbmQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwibGVuZ3RoIiwiY2xpY2siLCJ0aFN0ZXAiLCJjbG9zZXN0IiwiZmluZCIsImF0dHIiLCJzbGlkZXJTbGlkZXMiLCJlYWNoIiwicGFnaUluZGV4IiwibWVudUJ0biIsImdldEVsZW1lbnRCeUlkIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwib25yZXNpemUiLCJyZW1vdmUiLCJvbnNjcm9sbCIsIkNhdGFsb2ciLCJzZWxmIiwidGl0bGVDbGFzcyIsInByb2R1Y3RzQ29udGFpbmVyQ2xhc3MiLCJwcm9kdWN0c1ByZWxvYWRlckNsYXNzIiwiX2NsYXNzQ2FsbENoZWNrIiwidW5kZWZpbmVkIiwiX3NlbGYiLCJfdGl0bGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX3Byb2R1Y3RzIiwicHJlbG9hZGVyIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJpbm5lckhUTUwiLCJhZGQiLCJ0aXRsZSIsInNldEF0dHJpYnV0ZSIsInByb2R1Y3RzIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwiRmlsdGVyIiwiY29udGFpbmVyQnJhbmRzIiwiY29udGFpbmVyRmlsdGVyIiwiX2NvbnRhaW5lckJyYW5kcyIsIl9icmFuZEl0ZW0iLCJfY29udGFpbmVyRmlsdGVyIiwiX2ZpbHRlckl0ZW0iLCJzZWFyY2hJdGVtIiwiX2FjdGl2ZUNsYXNzIiwiX3NvcnRUeXBlQXNjIiwiY2xhc3MiLCJkYXRhU29ydCIsIl9zb3J0VHlwZURlc2MiLCJ0aW1lT3V0QWpheCIsImluaXQiLCJmb3JFYWNoIiwiaXRlbSIsInBhcmVudCIsInJlbW92ZUF0dHJpYnV0ZSIsImNvbnRhaW5zIiwiZGVsYXkiLCJjbGVhclRpbWVvdXQiLCJicmFuZCIsImdldFF1ZXJ5IiwiYXJyYXlRdWVyeSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicHVzaCIsImdldEF0dHJpYnV0ZSIsImpvaW4iLCJIaXN0b3J5Q29ucnRvbCIsInNldEhpc3RvcnkiLCJhamF4Q29ubmVjdCIsIkFqYXhHZXRQcm9kdWN0cyIsInNlbmQiLCJjYXRhbG9kVGVzdCIsInBsYXlQcmVsb2FkZXIiLCJjb25zb2xlIiwibG9nIiwiX3Rvb2dsZVNvcnQiLCJfY2xlYW5DbGFzc0ZpbHRlckFsbCIsIl9hZGRDbGFzc0ZpbHRlciIsIl9xdWVyeUZvcm1hdGlvbiIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJfc2VsZWN0QnJhbmQiLCJ1cmwiLCJfdXJsIiwiX2hpc3RvcnlPYmoiLCJoaXN0b3J5Iiwic3RhdGUiLCJyZXBsYWNlU3RhdGUiLCJwdXNoU3RhdGUiLCJ0eXBlIiwiX3R5cGUiLCJhamF4IiwiWE1MSHR0cFJlcXVlc3QiLCJyZXN1bHQiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZSIsInVwZGF0ZVRpdGxlIiwidXBkYXRlTGlzdFByb2R1Y3RzIiwiZWxlbWVudHMiLCJzdG9wUHJlbG9hZGVyIiwiZGF0YSIsIl9wcm9ncmVzcyIsIl9jb21wbGV0ZSIsInRvTG93ZXJDYXNlIiwib3BlbiIsImZpbHRlciIsImUiLCJzbGlkZVRvZ2dsZSIsInJlc2l6ZVBvcyIsImFjdGl2ZUxpbmtQb3NMZWZ0IiwiYWN0aXZlTGluayIsInBvc2l0aW9uIiwibGVmdCIsImFjdGl2ZUxpbmtQb3NUb3AiLCJ0b3AiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJob3ZlckJveCIsImNzcyIsIndpZHRoIiwiaGVpZ2h0IiwibWVudUxpbmsiLCJjaGVjayIsImhvdmVyIiwibmV3TGlua1Bvc0xlZnQiLCJuZXdMaW5rUG9zVG9wIiwibmV3TGlua1dpZHRoIiwibmV3TGlua0hlaWdodCIsInJlc2l6ZSIsImZvY3Vzb3V0IiwidmFsIiwic2NlbmUiLCJQYXJhbGxheCIsInRvZ2dsZUNsYXNzIl0sIm1hcHBpbmdzIjoibVpBQ0lBLEVBQUVDLFVBQVVDLEdBQUcsUUFBUyxrQkFBbUIsV0FDbENGLEVBQUVHLE1BQU1DLFNBQVMsYUFDbEJKLEVBQUVHLE1BQU1FLFNBQVMsV0FDakJMLEVBQUVHLE1BQU1FLFNBQVMsaUJBQ2pCQyxXQUFXLFdBQ1BOLEVBQUVHLE1BQU1JLFlBQVksaUJBQ3BCUCxFQUFFRyxNQUFNSSxZQUFZLFlBQ3RCQyxLQUFLTCxNQUFPLFFDTnRCTSxPQUFPQyxpQkFBaUIsT0FBUSxXQUV4QlYsRUFBRSxZQUFZVyxRQUVkWCxFQUFFLHdCQUF3QlksTUFBTSxXQUM1QixJQUFJQyxFQUFTYixFQUFFRyxNQUNmLElBQUtVLEVBQU9ULFNBQVMsYUFBYyxDQUMvQlMsRUFBT0MsUUFBUSxZQUFZQyxLQUFLLHdCQUF3QlIsWUFBWSxhQUFhQSxZQUFZLFVBQzdGTSxFQUFPUixTQUFTLGFBQWFBLFNBQVMsVUFDdEJRLEVBQU9HLEtBQUssY0FBNUIsSUFFSUMsRUFBZUosRUFBT0MsUUFBUSxZQUFZQyxLQUFLLG9CQUNuREUsRUFBYVYsWUFBWSxhQUN6QlUsRUFBYUMsS0FBSyxTQUFTQyxFQUFXTixHQUM5QmIsRUFBRUcsTUFBTWEsS0FBSyxlQUFpQmhCLEVBQUUsa0NBQWtDZ0IsS0FBSyxlQUN2RWhCLEVBQUVHLE1BQU1FLFNBQVMsb0JDakI1QyxXQUNHLElBQUllLEVBQVVuQixTQUFTb0IsZUFBZSxlQUV0Q0QsRUFBUVYsaUJBQWlCLFFBQVMsV0FDOUJVLEVBQVFFLFVBQVVDLE9BQU8sWUFHN0JkLE9BQU9lLFNBQVcsV0FDZEosRUFBUUUsVUFBVUcsT0FBTyxXQUU3QmhCLE9BQU9pQixTQUFXLFdBQ2ROLEVBQVFFLFVBQVVHLE9BQU8sV0FYaEMsR0NBQSxXQUFXLElBRUZFLEVBRkUsV0FHSixTQUFB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L0ksRUFBRUMsVUFBVUMsR0FBRyxRQUFTLHNCQUF1QixXQUMzQ0YsRUFBRUcsTUFBTVcsUUFBUSxlQUFlQyxLQUFLLHVCQUF1QmtJLFlBQVksYUFDdkVqSixFQUFFRyxNQUFNVyxRQUFRLGVBQWVDLEtBQUssd0JBQXdCd0csWUFBWSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsoZnVuY3Rpb24oKSB7XHJcbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmJ1dHRvbi0tYmFza2V0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdhbmltYXRlJykpIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnYW5pbWF0ZScpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYnV0dG9uLS1jaGVja1wiKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJidXR0b24tLWNoZWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYW5pbWF0ZScpO1xyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksIDIwMDApO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KSgpO1xyXG4iLCI7KGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIGlmICgkKCcuaHItc2VjdCcpLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgJChcIi5oci1wYWdpbmF0aW9uX19zdGVwXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRoU3RlcCA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoU3RlcC5oYXNDbGFzcyhcImlzLWFjdGl2ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoU3RlcC5jbG9zZXN0KCcuaHItc2VjdCcpLmZpbmQoXCIuaHItcGFnaW5hdGlvbl9fc3RlcFwiKS5yZW1vdmVDbGFzcyhcImlzLWFjdGl2ZVwiKS5yZW1vdmVDbGFzcyhcImJ1dHRvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICB0aFN0ZXAuYWRkQ2xhc3MoXCJpcy1hY3RpdmVcIikuYWRkQ2xhc3MoXCJidXR0b25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2lJbmRleCA9IHRoU3RlcC5hdHRyKFwiZGF0YS1pbmRleFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNsaWRlclNsaWRlcyA9IHRoU3RlcC5jbG9zZXN0KFwiLmhyLXNlY3RcIikuZmluZChcIi5oci1zbGlkZXItc2xpZGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyU2xpZGVzLnJlbW92ZUNsYXNzKFwiaXMtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlclNsaWRlcy5lYWNoKGZ1bmN0aW9uKHBhZ2lJbmRleCwgdGhTdGVwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJkYXRhLWluZGV4XCIpID09ICQoXCIuaHItcGFnaW5hdGlvbl9fc3RlcC5pcy1hY3RpdmVcIikuYXR0cihcImRhdGEtaW5kZXhcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbn0pKCk7XHJcbiIsIjsoZnVuY3Rpb24oKSB7XHJcbiAgICBsZXQgbWVudUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LWJ1dHRvbicpO1xyXG5cclxuICAgIG1lbnVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBtZW51QnRuLmNsYXNzTGlzdC50b2dnbGUoJ29wZW5lZCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgd2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgbWVudUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuZWQnKTtcclxuICAgIH1cclxuICAgIHdpbmRvdy5vbnNjcm9sbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG1lbnVCdG4uY2xhc3NMaXN0LnJlbW92ZSgnb3BlbmVkJyk7XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIjsoZnVuY3Rpb24oKXtcclxuXHJcbiAgICBjbGFzcyBDYXRhbG9nIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihzZWxmLCB0aXRsZUNsYXNzLCBwcm9kdWN0c0NvbnRhaW5lckNsYXNzLCBwcm9kdWN0c1ByZWxvYWRlckNsYXNzKXtcclxuICAgICAgICAgICAgaWYgKHNlbGYgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX3NlbGYgPSBzZWxmO1xyXG4gICAgICAgICAgICB0aGlzLl90aXRsZSA9IHRoaXMuX3NlbGYucXVlcnlTZWxlY3RvckFsbChcIi5cIiArIHRpdGxlQ2xhc3MpWzBdO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9kdWN0cyA9IHRoaXMuX3NlbGYucXVlcnlTZWxlY3RvckFsbChcIi5cIiArIHByb2R1Y3RzQ29udGFpbmVyQ2xhc3MpWzBdO1xyXG4gICAgICAgICAgICB0aGlzLnByZWxvYWRlciA9IHRoaXMuX3NlbGYucXVlcnlTZWxlY3RvckFsbChcIi5cIiArIHByb2R1Y3RzUHJlbG9hZGVyQ2xhc3MpWzBdO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIF9jbGVhblByb2R1Y3RzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9kdWN0cy5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcGxheVByZWxvYWRlcigpIHtcclxuICAgICAgICAgICAgdGhpcy5wcmVsb2FkZXIuY2xhc3NMaXN0LmFkZChcInByZWxvYWRlci0tYWN0aXZlXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RvcFByZWxvYWRlcigpIHtcclxuICAgICAgICAgICAgdGhpcy5wcmVsb2FkZXIuY2xhc3NMaXN0LnJlbW92ZShcInByZWxvYWRlci0tYWN0aXZlXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdXBkYXRlVGl0bGUodGl0bGUpIHtcclxuICAgICAgICAgICAgdGhpcy5fdGl0bGUuaW5uZXJIVE1MID0gdGl0bGU7XHJcbiAgICAgICAgICAgIHRoaXMuX3RpdGxlLnNldEF0dHJpYnV0ZShcImRhdGEtbmFtZVwiLCB0aXRsZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB1cGRhdGVMaXN0UHJvZHVjdHMocHJvZHVjdHMpIHtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZHVjdHMuaW5uZXJIVE1MID0gcHJvZHVjdHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhZGRQcm9kdWN0cyhwcm9kdWN0cykge1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9kdWN0cy5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmVlbmRcIiwgcHJvZHVjdHMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGFzcyBGaWx0ZXIge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lckJyYW5kcywgY29udGFpbmVyRmlsdGVyKSB7XHJcbiAgICAgICAgICAgIGlmIChjb250YWluZXJCcmFuZHMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250YWluZXJGaWx0ZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9jb250YWluZXJCcmFuZHMgPSBjb250YWluZXJCcmFuZHM7XHJcbiAgICAgICAgICAgIHRoaXMuX2JyYW5kSXRlbSA9IHRoaXMuX2NvbnRhaW5lckJyYW5kcy5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2ctbmF2X19jb250cm9scy1saW5rXCIpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fY29udGFpbmVyRmlsdGVyID0gY29udGFpbmVyRmlsdGVyO1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJJdGVtID0gdGhpcy5fY29udGFpbmVyRmlsdGVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2F0YWxvZy1maWx0ZXJfX2NvbC1idG5cIik7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoSXRlbSA9IHRoaXMuX2NvbnRhaW5lckZpbHRlci5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2ctZmlsdGVyX19mb3JtXCIpWzBdO1xyXG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVDbGFzcyA9IFwiaXMtYWN0aXZlXCI7XHJcbiAgICAgICAgICAgIHRoaXMuX3NvcnRUeXBlQXNjID0ge1xyXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwic29ydC1kb3duXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhU29ydDogXCJhc2NcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0aGlzLl9zb3J0VHlwZURlc2MgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzczogXCJzb3J0LXVwXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhU29ydDogXCJkZXNjXCJcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy50aW1lT3V0QWpheDtcclxuICAgICAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfY2xlYW5DbGFzc0ZpbHRlckFsbCgpIHtcclxuICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fZmlsdGVySXRlbS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudCA9IGl0ZW0uY2xvc2VzdChcIi5jYXRhbG9nLWZpbHRlcl9fY29sXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoc2VsZi5fYWN0aXZlQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShzZWxmLl9zb3J0VHlwZUFzYy5jbGFzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJlbW92ZUF0dHJpYnV0ZShcImRhdGEtc29ydFwiKTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX2FkZENsYXNzRmlsdGVyKGl0ZW0pIHtcclxuICAgICAgICAgICAgbGV0IHBhcmVudCA9IGl0ZW0uY2xvc2VzdChcIi5jYXRhbG9nLWZpbHRlcl9fY29sXCIpO1xyXG5cclxuICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKHRoaXMuX2FjdGl2ZUNsYXNzKTtcclxuICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKHRoaXMuX3NvcnRUeXBlQXNjLmNsYXNzKTtcclxuXHJcbiAgICAgICAgICAgIHBhcmVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnRcIiwgdGhpcy5fc29ydFR5cGVBc2MuZGF0YVNvcnQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX3Rvb2dsZVNvcnQoaXRlbSkge1xyXG4gICAgICAgICAgICBsZXQgcGFyZW50ID0gaXRlbS5jbG9zZXN0KFwiLmNhdGFsb2ctZmlsdGVyX19jb2xcIik7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnModGhpcy5fc29ydFR5cGVBc2MuY2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc29ydFR5cGVBc2MuY2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKHRoaXMuX3NvcnRUeXBlRGVzYy5jbGFzcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcGFyZW50LnNldEF0dHJpYnV0ZShcImRhdGEtc29ydFwiLCB0aGlzLl9zb3J0VHlwZURlc2MuZGF0YVNvcnQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NvcnRUeXBlRGVzYy5jbGFzcyk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQodGhpcy5fc29ydFR5cGVBc2MuY2xhc3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIHBhcmVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnRcIiwgdGhpcy5fc29ydFR5cGVBc2MuZGF0YVNvcnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX3NlbGVjdEJyYW5kKGl0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKCFpdGVtLmNsYXNzTGlzdC5jb250YWlucyhcImlzLWFjdGl2ZVwiKSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9icmFuZEl0ZW0uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiaXMtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9xdWVyeUZvcm1hdGlvbihkZWxheSkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lT3V0QWpheCk7XHJcbiAgICAgICAgICAgIC8v0JzQtdGC0L7QtCDRhNC+0YDQvNC40YDQvtCy0LDQvdC40Y8gZ2V0INC30LDQv9GA0L7RgdCwXHJcbiAgICAgICAgICAgIGxldCBhcnJheVF1ZXJ5ID0gW10sXHJcbiAgICAgICAgICAgICAgICBzZWFyY2hJdGVtID0gdGhpcy5zZWFyY2hJdGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIilbMF0sXHJcbiAgICAgICAgICAgICAgICBicmFuZCxcclxuICAgICAgICAgICAgICAgIGdldFF1ZXJ5O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fYnJhbmRJdGVtLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKFwiaXMtYWN0aXZlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlRdWVyeS5wdXNoKFwiYnJhbmQ9XCIgKyBpdGVtLmdldEF0dHJpYnV0ZShcImRhdGEtYnJhbmRcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyYW5kID0gaXRlbS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWJyYW5kXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2ZpbHRlckl0ZW0uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50ID0gaXRlbS5jbG9zZXN0KFwiLmNhdGFsb2ctZmlsdGVyX19jb2xcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJpcy1hY3RpdmVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnJheVF1ZXJ5LnB1c2goXCJzb3J0PVwiICsgcGFyZW50LmdldEF0dHJpYnV0ZShcImRhdGEtc29ydFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlRdWVyeS5wdXNoKFwic29ydFR5cGU9XCIgKyBwYXJlbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1maWx0ZXJcIikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hJdGVtLnZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBhcnJheVF1ZXJ5LnB1c2goXCJzZWFyY2g9XCIgKyBzZWFyY2hJdGVtLnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZ2V0UXVlcnkgPSBcIj9cIiArIGFycmF5UXVlcnkuam9pbihcIiZcIik7XHJcblxyXG4gICAgICAgICAgICAvL1RvZG86INC30LTQtdGB0Ywg0LTQvtC70LbQtdC9INCy0YvQt9GL0LLQsNGC0YzRgdGPIGFqYXgg0Lgg0L/RgNC40L3QuNC80LDRgtGMIGdldCDRgdGC0YDQvtC60YNcclxuICAgICAgICAgICAgLy9Ub2RvOiDQt9C00LXRgdGMINC00L7Qu9C20LXQvSDQstGL0LfRi9Cy0LDRgtGM0YHRjyBoaXN0b3J5QVBJINC00LvRjyDRgdC+0YXRgNCw0L3QtdC90LjRjyDQuNGB0YLQvtGA0LjQuCDRgSBnZXQg0LfQsNC/0YDQvtGB0LDQvNC4XHJcbiAgICAgICAgICAgIGxldCBoaXN0b3J5T2JqID0gbmV3IEhpc3RvcnlDb25ydG9sKGdldFF1ZXJ5KTtcclxuICAgICAgICAgICAgaGlzdG9yeU9iai5zZXRIaXN0b3J5KGJyYW5kKTtcclxuXHJcbiAgICAgICAgICAgIC8v0KLQtdGB0YLQvtCy0L7QtSBhamF4INCd0YPQttC90L4g0LHRg9C00LXRgiDRg9C60LDQt9GL0LLQsNGC0Ywg0L3QvtCy0YvQuSDQsNC00YDQtdGBXHJcbiAgICAgICAgICAgIGxldCBhamF4Q29ubmVjdCA9IG5ldyBBamF4R2V0UHJvZHVjdHMoXCJ0ZXN0Lmpzb25cIiwgXCJnZXRcIik7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGVsYXkgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICBhamF4Q29ubmVjdC5zZW5kKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjYXRhbG9kVGVzdC5wbGF5UHJlbG9hZGVyKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVPdXRBamF4ID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFqYXhDb25uZWN0LnNlbmQoKTtcclxuICAgICAgICAgICAgICAgIH0sIGRlbGF5KVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhnZXRRdWVyeSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW5pdCgpIHtcclxuICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJJdGVtLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoc2VsZi5fYWN0aXZlQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3Rvb2dsZVNvcnQodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v0JLRi9C30L7QsiDQvNC10YLQvtC00LAg0YTQvtGA0LzQuNGA0L7QstCw0L3QuNGPIEdldCDQt9Cw0L/RgNC+0YHQsFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9xdWVyeUZvcm1hdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2NsZWFuQ2xhc3NGaWx0ZXJBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fYWRkQ2xhc3NGaWx0ZXIodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v0JLRi9C30L7QsiDQvNC10YLQvtC00LAg0YTQvtGA0LzQuNGA0L7QstCw0L3QuNGPIEdldCDQt9Cw0L/RgNC+0YHQsFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9xdWVyeUZvcm1hdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2JyYW5kSXRlbS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwiaXMtYWN0aXZlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbGVjdEJyYW5kKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL9CS0YvQt9C+0LIg0LzQtdGC0L7QtNCwINGE0L7RgNC80LjRgNC+0LLQsNC90LjRjyBHZXQg0LfQsNC/0YDQvtGB0LBcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fcXVlcnlGb3JtYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hJdGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIilbMF0uYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy/QktGL0LfQvtCyINC80LXRgtC+0LTQsCDRhNC+0YDQvNC40YDQvtCy0LDQvdC40Y8gR2V0INC30LDQv9GA0L7RgdCwXHJcbiAgICAgICAgICAgICAgICBzZWxmLl9xdWVyeUZvcm1hdGlvbigxMDAwKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xhc3MgSGlzdG9yeUNvbnJ0b2wge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKHVybCkge1xyXG4gICAgICAgICAgICB0aGlzLl91cmwgPSB1cmw7XHJcbiAgICAgICAgICAgIHRoaXMuX2hpc3RvcnlPYmogPSB3aW5kb3cuaGlzdG9yeTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldEhpc3RvcnkoYnJhbmQpIHtcclxuICAgICAgICAgICAgaWYgKGJyYW5kID09PSB0aGlzLl9oaXN0b3J5T2JqLnN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oaXN0b3J5T2JqLnJlcGxhY2VTdGF0ZShicmFuZCwgYnJhbmQsIHRoaXMuX3VybCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oaXN0b3J5T2JqLnB1c2hTdGF0ZShicmFuZCwgYnJhbmQsIHRoaXMuX3VybCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlYWRIaXN0b3J5KGdldFF1ZXJ5KSB7XHJcbiAgICAgICAgICAgIC8vVG9kbzog0LfQtNC10YHRjCDQvdGD0LbQvdC+INC/0LDRgNGB0LjRgtGMIGdldCDQt9Cw0L/RgNC+0YEg0Lgg0L/RgNC10LLQvtC00LjRgtGMINGB0L7RgdGC0L7Rj9C90LjQtSDRgdGC0YDQsNC90LjRhtGLINC6INCw0LrRgtGD0LDQu9GM0L3QvtC80YMg0LLQuNC00YNcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xhc3MgQWpheEdldFByb2R1Y3RzIHtcclxuICAgICAgICBjb25zdHJ1Y3Rvcih1cmwsIHR5cGUpIHtcclxuICAgICAgICAgICAgdGhpcy5fdXJsID0gdXJsO1xyXG4gICAgICAgICAgICB0aGlzLl90eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgdGhpcy5hamF4ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfcHJvZ3Jlc3MoKSB7XHJcbiAgICAgICAgICAgIGNhdGFsb2RUZXN0LnBsYXlQcmVsb2FkZXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9jb21wbGV0ZSgpIHtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IEpTT04ucGFyc2UodGhpcy5yZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICBjYXRhbG9kVGVzdC51cGRhdGVUaXRsZShyZXN1bHQudGl0bGUpO1xyXG4gICAgICAgICAgICBjYXRhbG9kVGVzdC51cGRhdGVMaXN0UHJvZHVjdHMocmVzdWx0LmVsZW1lbnRzKTtcclxuXHJcbiAgICAgICAgICAgIGNhdGFsb2RUZXN0LnN0b3BQcmVsb2FkZXIoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2VuZChkYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWpheC5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIiwgdGhpcy5fcHJvZ3Jlc3MsIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5hamF4LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIHRoaXMuX2NvbXBsZXRlLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fdHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImdldFwiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5hamF4Lm9wZW4odGhpcy5fdHlwZSwgdGhpcy5fdXJsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWpheC5zZW5kKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJnZXRcIik7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fdHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInBvc3RcIikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJwb3N0XCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvclwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgbGV0IGNhdGFsb2RUZXN0ID0gbmV3IENhdGFsb2coZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5jYXRhbG9nXCIpWzBdLCBcImNhdGFsb2dfX3RpdGxlXCIsIFwiY2F0YWxvZ19fcHJvZHVjdFwiLCBcInByZWxvYWRlclwiKTtcclxuXHJcbiAgICBsZXQgZmlsdGVyID0gbmV3IEZpbHRlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGFsb2ctbmF2X19jb250cm9sc1wiKVswXSwgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5jYXRhbG9nLWZpbHRlclwiKVswXSk7XHJcblxyXG5cclxuICAgIC8v0KLQtdGB0YJcclxuICAgIC8vIHdpbmRvdy5kaXZBcnJheSA9IGRpdkFycmF5O1xyXG4gICAgd2luZG93LmZpbHRlciA9IGZpbHRlcjtcclxufSkoKTtcclxuIiwiOyhmdW5jdGlvbigpIHtcclxuICAgIHZhciBidXR0b24gPSAkKCcuZm9vdGVyX19jb2wtdGl0bGUnKTtcclxuXHJcbiAgICBidXR0b24ub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5mb290ZXJfX2NvbCcpLmZpbmQoJy5mb290ZXJfX2NvbC1saXN0Jykuc2xpZGVUb2dnbGUoMzAwKTtcclxuICAgIH0pO1xyXG59KSgpO1xyXG4iLCI7KGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIGlmICgkKCcuY2F0YWxvZy1uYXZfX2NvbnRyb2xzJykubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWVudUxpbmsgPSAkKCcuY2F0YWxvZy1uYXZfX2NvbnRyb2xzLWxpbmsnKSxcclxuICAgICAgICAgICAgICAgIG1lbnUgPSAkKCcuY2F0YWxvZy1uYXZfX2NvbnRyb2xzLWxpc3QnKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtZW51SXRlbSA9ICQoJy5jYXRhbG9nLW5hdl9fY29udHJvbHMtaXRlbScpLFxyXG4gICAgICAgICAgICAgICAgYWN0aXZlTGluayA9ICQoJy5jYXRhbG9nLW5hdl9fY29udHJvbHMtbGluay5pcy1hY3RpdmUnKSxcclxuICAgICAgICAgICAgICAgIGhvdmVyQm94ID0gJCgnLmNhdGFsb2ctbmF2X19ob3ZlcicpLFxyXG4gICAgICAgICAgICAgICAgYWN0aXZlTGlua1Bvc0xlZnQgPSBhY3RpdmVMaW5rLnBvc2l0aW9uKCkubGVmdCxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUxpbmtQb3NUb3AgPSBhY3RpdmVMaW5rLnBvc2l0aW9uKCkudG9wLFxyXG4gICAgICAgICAgICAgICAgYWN0aXZlTGlua1dpZHRoID0gYWN0aXZlTGluay5pbm5lcldpZHRoKCksXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVMaW5rSGVpZ2h0ID0gYWN0aXZlTGluay5pbm5lckhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNoZWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG1lbnVMaW5rLmhvdmVyKFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG5ld0xpbmtQb3NMZWZ0ID0gJCh0aGlzKS5wb3NpdGlvbigpLmxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3TGlua1Bvc1RvcCA9ICQodGhpcykucG9zaXRpb24oKS50b3AsXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3TGlua1dpZHRoID0gJCh0aGlzKS5pbm5lcldpZHRoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3TGlua0hlaWdodCA9ICQodGhpcykuaW5uZXJIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgIGhvdmVyQm94LmNzcyh7J2xlZnQnIDogbmV3TGlua1Bvc0xlZnQsICd0b3AnIDogbmV3TGlua1Bvc1RvcCwgJ3dpZHRoJyA6IG5ld0xpbmtXaWR0aCwgJ2hlaWdodCcgOiBuZXdMaW5rSGVpZ2h0fSk7XHJcbiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICBpZiAoY2hlY2spIHtcclxuICAgICAgICAgICAgICAgICAgICBob3ZlckJveC5jc3MoeydsZWZ0JyA6IGFjdGl2ZUxpbmtQb3NMZWZ0LCAndG9wJyA6IGFjdGl2ZUxpbmtQb3NUb3AsICd3aWR0aCcgOiAwLCAnaGVpZ2h0JyA6IDB9KTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgICAgICBjaGVjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVzaXplUG9zKCkge1xyXG4gICAgICAgICAgICAgICAgYWN0aXZlTGlua1Bvc0xlZnQgPSBhY3RpdmVMaW5rLnBvc2l0aW9uKCkubGVmdCxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUxpbmtQb3NUb3AgPSBhY3RpdmVMaW5rLnBvc2l0aW9uKCkudG9wLFxyXG4gICAgICAgICAgICAgICAgYWN0aXZlTGlua1dpZHRoID0gYWN0aXZlTGluay5pbm5lcldpZHRoKCksXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVMaW5rSGVpZ2h0ID0gYWN0aXZlTGluay5pbm5lckhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGhvdmVyQm94LmNzcyh7J2xlZnQnIDogYWN0aXZlTGlua1Bvc0xlZnQsICd0b3AnIDogYWN0aXZlTGlua1Bvc1RvcCwgJ3dpZHRoJyA6IDAsICdoZWlnaHQnIDogMH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmVzaXplUG9zKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXNpemVQb3MoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcblxyXG59KSgpO1xyXG4iLCI7KGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICQoJy5kZWxpdmVyeV9fZm9ybS1pbnB1dCcpLmZvY3Vzb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICBpZiAoJCh0aGlzKS52YWwoKSAhPT0gJycpIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5hZGRDbGFzcygndmFsdWUnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCd2YWx1ZScpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG5cclxufSkoKTtcclxuIiwiOyhmdW5jdGlvbigpIHtcclxuXHJcbiAgICBsZXQgc2NlbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTtcclxuICAgIGlmIChzY2VuZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICBsZXQgcGFyYWxsYXhJbnN0YW5jZSA9IG5ldyBQYXJhbGxheChzY2VuZSk7XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCI7KGZ1bmN0aW9uKCkge1xyXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zbGlkZS1pbmZvX19idXR0b24nLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5zbGlkZS1pbmZvJykuZmluZCgnLnNsaWRlLWluZm9fX2J1dHRvbicpLnRvZ2dsZUNsYXNzKCdpcy1hY3RpdmUnKTtcclxuICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5zbGlkZS1pbmZvJykuZmluZCgnLnNsaWRlLWluZm9fX2NvbnRlbnQnKS5zbGlkZVRvZ2dsZSgzMDApO1xyXG4gICAgfSk7XHJcbn0pKCk7XHJcbiJdfQ==
